#!/usr/bin/with-contenv bash

[[ -n "${POOLING_FS:-}" ]] && rclone_mountpoint="/cloud" || rclone_mountpoint="/data"

rclone_mount_basic_opts="
--uid=${PUID:-911}
--gid=${PGID:-911}
--cache-dir=/cache
--use-mmap
--allow-other
--umask=002
--rc
--rc-no-auth
--rc-addr=:5574
"

mfs_basic_opts="uid=${PUID:-911},gid=${PGID:-911},umask=022,allow_other"
ufs_basic_opts="uid=${PUID:-911},gid=${PGID:-911},umask=022,allow_other"

function run_commands {
    COMMANDS=$1
    [ -z "$COMMANDS" ] && return
    echo "*** executing => $COMMANDS"
    while IFS= read -r cmd; do echo "$cmd" && eval "$cmd" ; done < <(printf '%s\n' "$COMMANDS")
}

function run_exit_commands {
    set +e
    set +o pipefail
    run_commands "${POST_COMMANDS_EXIT:-}"
}
